#!/usr/bin/env bash
export EDITOR=vim
UNAME=$(uname)

# DOTFILES HOME
DOTFILES_HOME=$HOME/code/dotfiles
DOTFILES_PRIVATE=$HOME/code/dotfiles.private
DOTFILES_LOCAL="${DOTFILES_PRIVATE}"/.bashrc_local
SECRETS_FILE="${DOTFILES_PRIVATE}"/.bashrc_secrets

# LANGUAGE VERSIONS
PYTHON_VERSION=2.7.13
RUBY_VERSION=2.3.0
OCAML_VERSION=4.02.3
NODE_VERSION=8

## LANGUAGE PATHS
PATH="~/.cabal/bin:/opt/cabal/1.20/bin:/opt/ghc/7.8.4/bin:/opt/happy/1.19.4/bin:/opt/alex/3.1.3/bin:$PATH";
PATH="$HOME/.pyenv/shims:$PATH"

## TOOL PATHS
PATH="$PATH:~/packer"; # packer
PATH="~/bin:${DOTFILES_PRIVATE}/bin:$PATH";
AWS_HOME="/opt/aws";

# chrome sandbox
export CHROME_DEVEL_SANDBOX=/usr/local/sbin/chrome-devel-sandbox

# google dev
export GDEV_HOME=~/code/goog
export PATH="$PATH:$GDEV_HOME/depot_tools"

. $DOTFILES_HOME/includes/color.sh
. $DOTFILES_HOME/includes/logging.sh

if [[ $UNAME -ne 'Darwin' ]]; then
	# video modes
	VM_U2713HM="U2713HM"
	VM_U2713HM_MODELINE="172.80 1920 2040 2248 2576  1080 1081 1084 1118 -hsync +vsync"
	VM_WORK=$VM_U2713HM
	VM_SURFACE_SCALED="109.50  1368 1448 1592 1816  768 771 781 805 -hsync +vsync"
	VM_B2440="172.80  1920 2040 2248 2576  1080 1081 1084 1118  -hsync +vsync"
	DISPLAY_INTERNAL=`xrandr | sed -n 2p | cut -f1 -d$' '`
fi

# not typically using a gnome environment so better to have this off
unset GNOME_KEYRING_CONTROL

# initialize ssh_agent
eval $(ssh-agent) > /dev/null
ssh-add 2> /dev/null

# synaptic client changes
hash synclient 2> /dev/null && synclient > /dev/null 2>&1 && synclient TapButton1=0 TapButton2=0 RTCornerButton=0 RBCornerButton=0 ClickFinger1=0 ClickFinger2=0

# general prompt configuration
. $DOTFILES_HOME/scripts/_prompt.sh

# init aliases
. $DOTFILES_HOME/scripts/_aliases.sh

# bash scripting helpers
if [[ $UNAME -ne 'Darwin' ]]; then
	. $DOTFILES_HOME/scripts/roxterm.sh
	. $DOTFILES_HOME/scripts/screencasting.sh
fi

# git completion
source $DOTFILES_HOME/bin/git-completion.bash

echo -ne "\033]0;Configuring and Installing Languages\007";

# language configuration
echo -ne "${YELLOW}langs:\t${NC}"
. $DOTFILES_HOME/scripts/go.sh
. $DOTFILES_HOME/scripts/node.sh
. $DOTFILES_HOME/scripts/python.sh
. $DOTFILES_HOME/scripts/ruby.sh
. $DOTFILES_HOME/scripts/altjs.sh
. $DOTFILES_HOME/scripts/tools.sh
echo -ne "\n"

# run the npm install script in the $DOTFILES_HOME path
pushd $DOTFILES_HOME > /dev/null; npm install; popd > /dev/null;

# opam initialisation (ocaml)
$HOME/.opam/opam-init/init.sh > /dev/null 2> /dev/null || true

# tune editors
. $DOTFILES_HOME/scripts/editors/intellij.sh

# bring in local configuration settings
[[ -e "${DOTFILES_LOCAL}" ]] && source "${DOTFILES_LOCAL}"

# include the bash secrets file
[[ -e "${SECRETS_FILE}" ]] && source "${SECRETS_FILE}"

# define some video modes for different monitor configurations
xrandr --newmode "$VM_U2713HM" $VM_U2713HM_MODELINE &> /dev/null
xrandr --newmode "INTERNAL_SCALED" $VM_SURFACE_SCALED &> /dev/null
xrandr --newmode "VM_B2440" $VM_B2440 &> /dev/null
